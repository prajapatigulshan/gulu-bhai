<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GBG Infinite Runner - Final</title>
<style>
  body{margin:0;font-family:Arial;color:#fff;background:#050509;}
  header{position:fixed;top:0;left:0;right:0;height:64px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;background:linear-gradient(180deg,#111,#000);z-index:1000;box-shadow:0 4px 10px rgba(0,0,0,0.5);}
  header .title{font-weight:700;font-size:18px;background:linear-gradient(90deg,red,orange,yellow,green,cyan,blue,violet);-webkit-background-clip:text;color:transparent;}
  header .header-right{display:flex;gap:10px;align-items:center;}
  header button{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700;background:#111;color:#fff;}
  main{padding-top:78px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap;}
  canvas{border-radius:12px;background:linear-gradient(180deg,#07101a,#0b0b0f);width:900px;height:420px;box-shadow:0 10px 30px rgba(0,0,0,0.6);}
  .sidebar{width:320px;display:flex;flex-direction:column;gap:12px;}
  .panel{background:rgba(255,255,255,0.05);padding:10px;border-radius:12px;}
  .panel h3{margin:0 0 8px 0;font-size:16px;}
  #leaderboard ol{padding-left:18px;margin:0;max-height:250px;overflow:auto;}
  #leaderboard li{padding:6px 8px;margin-bottom:6px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:8px;}
  .highest{color:#0ff;font-weight:800;border-left:4px solid #0ff;padding-left:6px;}
  .controls{display:flex;gap:10px;justify-content:center;margin-top:6px;}
  .ctrl-btn{flex:1;padding:14px;border-radius:12px;font-size:20px;border:none;cursor:pointer;background:linear-gradient(90deg,#222,#111);color:#fff;}
  .ctrl-btn.big{flex:2;}
</style>
</head>
<body>
<header>
  <div class="title">GBG Infinite Runner</div>
  <div class="header-right">
    <div>Coins: <span id="coinCount">0</span></div>
    <button id="startBtn">Play Now</button>
  </div>
</header>
<main>
  <canvas id="gameCanvas" width="900" height="420"></canvas>
  <aside class="sidebar">
    <div class="panel" id="leaderboard">
      <h3>Leaderboard</h3>
      <ol id="scoreList"></ol>
    </div>
  </aside>
</main>
<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
let w=canvas.width,h=canvas.height;
function resizeCanvas(){canvas.style.width=Math.min(window.innerWidth-24,1000)+'px';}
window.addEventListener('resize',resizeCanvas);resizeCanvas();

/* ---------------- Game Variables ---------------- */
let playerName=null;
let playerCoins=0;
let scoreThisRun=0;
let highScores=JSON.parse(localStorage.getItem('highScores')||'[]');
let gameStarted=false;
let player={x:120,y:h-58,w:48,h:48,vy:0,onGround:true};
let coins=[],enemies=[];
const gravity=0.8,speed=6,jumpStrength=12;
const coinSize=18,enemySize=38;

/* ---------------- Input ---------------- */
const keys={};
window.addEventListener('keydown',e=>keys[e.key]=true);
window.addEventListener('keyup',e=>keys[e.key]=false);
canvas.addEventListener('click',()=>gameStarted?doJump():startGame());

/* ---------------- Player Actions ---------------- */
function doJump(){if(player.onGround){player.vy=-jumpStrength;player.onGround=false;}}

/* ---------------- Spawn ---------------- */
function spawnCoin(y){coins.push({x:Math.random()*(w-coinSize-20)+10,y:y||-Math.random()*h*0.6});}
function spawnEnemy(y){enemies.push({x:Math.random()*(w-enemySize-20)+10,y:y||-Math.random()*h*0.8,w:enemySize,h:enemySize});}
function spawnInitial(){coins=[];enemies=[];for(let i=0;i<8;i++)spawnCoin(-Math.random()*h*2);for(let i=0;i<4;i++)spawnEnemy(-Math.random()*h*2);}

/* ---------------- Game Loop ---------------- */
function update(){
  if(!gameStarted)return;
  if(keys['ArrowLeft'])player.x-=speed;
  if(keys['ArrowRight'])player.x+=speed;
  if(keys['ArrowUp']){doJump();keys['ArrowUp']=false;}
  if(player.x<6)player.x=6;if(player.x+player.w>w-6)player.x=w-6-player.w;
  player.vy+=gravity;player.y+=player.vy;
  if(player.y+player.h>=h-10){player.y=h-10-player.h;player.vy=0;player.onGround=true;}else player.onGround=false;

  for(let i=coins.length-1;i>=0;i--){
    coins[i].y+=2;
    if(coins[i].y>h+40)coins.splice(i,1),spawnCoin();
    else if(collide(player,coins[i])){coins.splice(i,1);addCoins(1);scoreThisRun++;spawnCoin(-50);}
  }
  for(let i=enemies.length-1;i>=0;i--){
    enemies[i].y+=2.5;
    if(enemies[i].y>h+60)enemies.splice(i,1),spawnEnemy(-Math.random()*h*0.5);
    else if(collide(player,enemies[i]))endGame();
  }
}
function collide(a,b){return a.x<a.x+a.w && a.x+a.w>b.x && a.y<a.y+a.h && a.y+a.h>b.y;}

/* ---------------- Draw ---------------- */
function draw(){
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle='#07101a';ctx.fillRect(0,0,w,h);
  ctx.fillStyle='#071922';ctx.fillRect(0,h-10,w,10);
  ctx.fillStyle='#ff4466';ctx.fillRect(player.x,player.y,player.w,player.h);
  ctx.fillStyle='#fff';ctx.fillRect(player.x+8,player.y+12,8,8);
  ctx.fillStyle='#ffd54d';coins.forEach(c=>{ctx.fillRect(c.x,c.y,coinSize,coinSize);ctx.strokeStyle='#b8860b';ctx.strokeRect(c.x,c.y,coinSize,coinSize);});
  ctx.fillStyle='#72d572';enemies.forEach(e=>{ctx.fillRect(e.x,e.y,e.w,e.h);ctx.fillStyle='#2e7d32';ctx.fillRect(e.x+6,e.y+6,e.w-12,e.h-12);ctx.fillStyle='#72d572';});
  ctx.fillStyle='#fff';ctx.font='16px Arial';ctx.fillText('Score: '+scoreThisRun,12,24);
  ctx.fillText('Coins: '+playerCoins,12,44);
  ctx.fillText('Player: '+(playerName||'Guest'),12,64);
}

/* ---------------- Game Loop ---------------- */
let rafId;
function gameLoop(){update();draw();rafId=requestAnimationFrame(gameLoop);}

/* ---------------- Start / End ---------------- */
function startGame(){
  if(!playerName){
    let name=prompt('Enter unique name:')||'Player'+Math.floor(Math.random()*999);name=name.trim().slice(0,20);
    if(highScores.find(h=>h.name===name))return alert('Name exists, choose another!');
    playerName=name;localStorage.setItem('playerName',playerName);
  }
  gameStarted=true;scoreThisRun=0;player.x=w/6;player.y=h-10-player.h;player.vy=0;player.onGround=true;
  spawnInitial();cancelAnimationFrame(rafId);gameLoop();
}
function endGame(){
  gameStarted=false;cancelAnimationFrame(rafId);
  saveScore();renderLeaderboard();alert('Game Over! Your score: '+scoreThisRun);
}
function addCoins(n){playerCoins+=n;localStorage.setItem('playerCoins',playerCoins);}

/* ---------------- Leaderboard ---------------- */
function saveScore(){
  if(!playerName)return;
  const existing=highScores.find(h=>h.name===playerName);
  if(existing)existing.score=Math.max(existing.score,scoreThisRun);
  else highScores.push({name:playerName,score:scoreThisRun});
  highScores.sort((a,b)=>b.score-a.score);
  localStorage.setItem('highScores',JSON.stringify(highScores));
}
function renderLeaderboard(){
  const list=document.getElementById('scoreList');list.innerHTML='';
  highScores.slice(0,100).forEach((h,i)=>{
    const li=document.createElement('li');li.innerText=`${i+1}. ${h.name} â€” ${h.score}`;
    if(i===0)li.classList.add('highest');list.appendChild(li);
  });
}

/* ---------------- Init ---------------- */
function init(){renderLeaderboard();playerCoins=parseInt(localStorage.getItem('playerCoins')||'0');document.getElementById('coinCount').innerText=playerCoins;}
init();
</script>
</body>
</html>
