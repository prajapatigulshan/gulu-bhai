<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GBG Ultimate Car Game - Final</title>
<style>
body { margin:0; font-family:Arial,sans-serif; background:#111; color:white; overflow:hidden; }
header { position:fixed; top:0; width:100%; background:#000c; padding:15px; display:flex; justify-content:space-between; align-items:center; z-index:1000; }
#startBtn { padding:10px 20px; font-size:18px; border:none; border-radius:10px; cursor:pointer; background:linear-gradient(to right, red, orange, yellow, green, cyan, blue, violet); color:white; }
canvas { display:block; margin:90px auto 20px auto; background:#87CEEB; border:3px solid #0ff; border-radius:12px; }
.controls { position:fixed; bottom:20px; width:100%; display:flex; justify-content:center; gap:20px; }
.controls button { padding:15px 20px; font-size:18px; border:none; border-radius:12px; cursor:pointer; background:linear-gradient(to right, red, orange, yellow, green, cyan, blue, violet); color:white; }
#commandPrompt { position:fixed; left:10px; top:80px; width:300px; height:400px; background:#000c; overflow-y:auto; padding:10px; border-radius:12px; font-family:monospace; }
#commandPrompt input { width:90%; padding:5px; margin-top:10px; border-radius:5px; border:none; }
#leaderboard { position:fixed; right:10px; top:80px; width:250px; height:400px; background:#000c; overflow-y:auto; padding:10px; border-radius:12px; }
#gameOverPopup { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(0); background:#000c; padding:30px; border-radius:15px; text-align:center; transition:0.3s; }
#gameOverPopup.show { transform:translate(-50%,-50%) scale(1); }
#gameOverPopup button { padding:10px 20px; margin-top:15px; border:none; border-radius:10px; cursor:pointer; background:linear-gradient(to right, red, orange, yellow, green, cyan, blue, violet); color:white; }
</style>
</head>
<body>

<header>
  <div>GBG Car Game Final</div>
  <button id="startBtn">Start Game</button>
</header>

<div id="commandPrompt">
  <p>// Commands: speed X, coin X</p>
  <input type="text" id="cmdInput" placeholder="Type command and press Enter">
</div>

<div id="leaderboard">
  <h3>Leaderboard</h3>
  <ol id="scoreList"></ol>
</div>

<canvas id="game" width="800" height="400"></canvas>

<div class="controls">
  <button id="leftBtn">⬅️</button>
  <button id="rightBtn">➡️</button>
</div>

<div id="gameOverPopup">
  <h2>Game Over!</h2>
  <p id="finalScore"></p>
  <button onclick="restartGame()">OK</button>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let gameStarted = false;
let speed = 5;
let score = 0;
let coins = [];
let coinSize = 20;
let player = {x:375, y:300, w:50, h:50, dx:0};
let keys = {};
let highScores = JSON.parse(localStorage.getItem('highScores')) || [];

// Start Game
function startGame(){
  gameStarted = true;
  score = 0;
  coins = [];
  player.x = 375; player.y = 300; player.dx = 0;
  document.getElementById('startBtn').style.display='none';
  spawnCoin();
  renderLeaderboard();
  requestAnimationFrame(gameLoop);
}

document.getElementById('startBtn').addEventListener('click', startGame);

// Spawn Coin
function spawnCoin(){
  let x = Math.random()*(canvas.width-coinSize);
  let y = Math.random()*(canvas.height-coinSize-50) + 50;
  coins.push({x,y,scale:0});
}

// Draw
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Player
  ctx.fillStyle='red';
  player.x += player.dx;
  ctx.fillRect(player.x, player.y, player.w, player.h);

  // Coins with scale animation
  ctx.fillStyle='yellow';
  coins.forEach(c=>{
    if(c.scale<1) c.scale += 0.05;
    ctx.save();
    ctx.translate(c.x+coinSize/2, c.y+coinSize/2);
    ctx.scale(c.scale,c.scale);
    ctx.fillRect(-coinSize/2,-coinSize/2,coinSize,coinSize);
    ctx.restore();
  });

  // Score
  ctx.fillStyle='black';
  ctx.font='20px Arial';
  ctx.fillText('Score: '+score,10,30);
}

// Update
function update(){
  // Horizontal movement
  if(keys['ArrowLeft']) player.dx = -speed;
  else if(keys['ArrowRight']) player.dx = speed;
  else player.dx = 0;

  // Forward auto-move
  player.y -= 2;
  
  // Coins collision
  coins.forEach((c,i)=>{
    if(player.x< c.x+coinSize && player.x+player.w>c.x && player.y<c.y+coinSize && player.y+player.h>c.y){
      coins.splice(i,1);
      score++;
      spawnCoin();
      renderLeaderboard();
    }
  });

  // Boundary checks
  if(player.x<0) player.x=0;
  if(player.x+player.w>canvas.width) player.x=canvas.width-player.w;
  if(player.y<0) player.y=0;
  if(player.y+player.h>canvas.height) player.y=canvas.height-player.h;

  if(score>=20){ endGame(); }
}

// Game Loop
function gameLoop(){
  if(!gameStarted) return;
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

// Game Over
function endGame(){
  gameStarted=false;
  document.getElementById('finalScore').innerText='Coins collected: '+score;
  const popup = document.getElementById('gameOverPopup');
  popup.classList.add('show');
  let playerName = prompt('Enter your name:');
  if(playerName){
    highScores.push({name:playerName, score});
    highScores.sort((a,b)=>b.score-a.score);
    localStorage.setItem('highScores', JSON.stringify(highScores));
    renderLeaderboard();
  }
}

function restartGame(){
  const popup = document.getElementById('gameOverPopup');
  popup.classList.remove('show');
  startGame();
}

// Render Leaderboard
function renderLeaderboard(){
  const list = document.getElementById('scoreList');
  list.innerHTML='';
  highScores.slice(0,10).forEach(h=>{
    let li=document.createElement('li');
    li.innerText=h.name+' - '+h.score;
    list.appendChild(li);
  });
}

// Controls
window.addEventListener('keydown', e=>keys[e.key]=true);
window.addEventListener('keyup', e=>keys[e.key]=false);
document.getElementById('leftBtn').addEventListener('touchstart',()=>keys['ArrowLeft']=true);
document.getElementById('leftBtn').addEventListener('touchend',()=>keys['ArrowLeft']=false);
document.getElementById('rightBtn').addEventListener('touchstart',()=>keys['ArrowRight']=true);
document.getElementById('rightBtn').addEventListener('touchend',()=>keys['ArrowRight']=false);

// Command Input
document.getElementById('cmdInput').addEventListener('keydown', function(e){
  if(e.key==='Enter'){
    executeCommand(this.value);
    this.value='';
  }
});

function executeCommand(cmd){
  const parts = cmd.trim().split(' ');
  if(parts[0]==='speed'){
    let val=parseInt(parts[1]);
    if(!isNaN(val)) speed=val;
  } else if(parts[0]==='coin'){
    let val=parseInt(parts[1]);
    if(!isNaN(val)) for(let i=0;i<val;i++) spawnCoin();
    renderLeaderboard();
  }
}

renderLeaderboard();
</script>
</body>
</html>
