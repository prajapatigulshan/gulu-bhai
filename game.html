<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GBG Car Game</title>
<style>
  body { margin:0; overflow:hidden; background: linear-gradient(270deg, red, orange, yellow, green, cyan, blue, violet); background-size: 2000% 2000%; animation:bgRGB 60s linear infinite; font-family:Arial,sans-serif; }
  @keyframes bgRGB {
    0%{background-position:0% 50%;}
    50%{background-position:100% 50%;}
    100%{background-position:0% 50%;}
  }
  canvas { display:block; margin:auto; background:#222; }
  .score {
    position:absolute; top:10px; left:50%; transform:translateX(-50%);
    font-size:24px; font-weight:bold;
    background: linear-gradient(90deg, red, orange, yellow, green, cyan, blue, violet);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-size: 400%; animation: rgbMove 8s linear infinite;
  }
  @keyframes rgbMove {
    0%{background-position:0% 50%;}
    50%{background-position:100% 50%;}
    100%{background-position:0% 50%;}
  }
  /* Mobile controls */
  .controls {
    position:absolute; bottom:20px; width:100%; display:flex; justify-content:space-around;
  }
  .btn {
    width:80px; height:80px; border-radius:50%; background:rgba(255,255,255,0.2);
    border:none; font-size:24px; color:white; font-weight:bold;
    user-select:none; -webkit-user-select:none;
  }
  /* Settings */
  #settingsMenu {
    position:absolute; top:50px; right:20px; background:rgba(0,0,0,0.7); color:white; padding:15px; border-radius:12px; display:none; z-index:1000;
  }
  #settingsMenu label, #settingsMenu select { display:block; margin:10px 0; }
  #settingsBtn {
    position:absolute; top:10px; right:10px; padding:10px 15px; border:none; border-radius:6px; background:rgba(0,0,0,0.6); color:white; font-weight:bold;
  }
</style>
</head>
<body>

<div class="score" id="scoreDisplay">Score: 0</div>
<button id="settingsBtn">⚙️ Settings</button>
<div id="settingsMenu">
  <label>Left Control Key: 
    <select id="leftKeySelect">
      <option value="ArrowLeft">Arrow Left</option>
      <option value="KeyA">A</option>
    </select>
  </label>
  <label>Right Control Key: 
    <select id="rightKeySelect">
      <option value="ArrowRight">Arrow Right</option>
      <option value="KeyD">D</option>
    </select>
  </label>
</div>

<canvas id="gameCanvas" width="400" height="600"></canvas>

<div class="controls">
  <button class="btn" id="leftBtn">◀</button>
  <button class="btn" id="rightBtn">▶</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let score = 0;
let gameOver = false;

// Car
const car = { x:180, y:500, w:40, h:70, speed:5 };

// Obstacles
let obstacles = [];
function addObstacle() {
  const width = 50 + Math.random()*50;
  const x = Math.random()*(canvas.width-width);
  obstacles.push({x:x, y:-70, w:width, h:20, speed:4});
}

// Coins
let coins = [];
function addCoin() {
  const size = 20;
  const x = Math.random()*(canvas.width-size);
  coins.push({x:x, y:-30, w:size, h:size});
}

// Controls
let leftPressed=false, rightPressed=false;
let leftKey='ArrowLeft', rightKey='ArrowRight';

document.addEventListener('keydown', e => {
  if(e.code===leftKey) leftPressed=true;
  if(e.code===rightKey) rightPressed=true;
});
document.addEventListener('keyup', e => {
  if(e.code===leftKey) leftPressed=false;
  if(e.code===rightKey) rightPressed=false;
});
document.getElementById('leftBtn').addEventListener('touchstart',()=>leftPressed=true);
document.getElementById('leftBtn').addEventListener('touchend',()=>leftPressed=false);
document.getElementById('rightBtn').addEventListener('touchstart',()=>rightPressed=true);
document.getElementById('rightBtn').addEventListener('touchend',()=>rightPressed=false);

// Settings Menu
const settingsBtn = document.getElementById('settingsBtn');
const settingsMenu = document.getElementById('settingsMenu');
settingsBtn.addEventListener('click', ()=>{
  settingsMenu.style.display = settingsMenu.style.display==='none'?'block':'none';
});
document.getElementById('leftKeySelect').addEventListener('change',(e)=>{ leftKey=e.target.value; });
document.getElementById('rightKeySelect').addEventListener('change',(e)=>{ rightKey=e.target.value; });

// Collision detection
function isColliding(a,b){
  return a.x < b.x + b.w &&
         a.x + a.w > b.x &&
         a.y < b.y + b.h &&
         a.y + a.h > b.y;
}

// Game Loop
let obstacleTimer=0;
let coinTimer=0;

function loop(){
  if(gameOver) return;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Move car
  if(leftPressed) car.x -= car.speed;
  if(rightPressed) car.x += car.speed;
  if(car.x<0) car.x=0;
  if(car.x+car.w>canvas.width) car.x=canvas.width-car.w;

  // Draw car
  ctx.fillStyle='lime';
  ctx.fillRect(car.x, car.y, car.w, car.h);

  // Add obstacles
  obstacleTimer++;
  if(obstacleTimer>60){ addObstacle(); obstacleTimer=0; }

  // Move & draw obstacles
  ctx.fillStyle='red';
  for(let i=0;i<obstacles.length;i++){
    obstacles[i].y += obstacles[i].speed;
    ctx.fillRect(obstacles[i].x, obstacles[i].y, obstacles[i].w, obstacles[i].h);
    if(isColliding(car,obstacles[i])) { gameOver=true; alert('Game Over! Score: '+score); location.reload(); }
    if(obstacles[i].y>canvas.height) obstacles.splice(i,1);
  }

  // Add coins
  coinTimer++;
  if(coinTimer>90){ addCoin(); coinTimer=0; }

  // Move & draw coins
  ctx.fillStyle='yellow';
  for(let i=0;i<coins.length;i++){
    coins[i].y += 4;
    ctx.beginPath();
    ctx.arc(coins[i].x+coins[i].w/2, coins[i].y+coins[i].h/2, coins[i].w/2,0,Math.PI*2);
    ctx.fill();
    if(isColliding(car,coins[i])) { score++; coins.splice(i,1); }
    if(coins[i] && coins[i].y>canvas.height) coins.splice(i,1);
  }

  // Update score
  document.getElementById('scoreDisplay').innerText = 'Score: '+score;

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
