<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GBG Infinite Runner - Final</title>
<style>
:root{
  --accent: linear-gradient(90deg, #ff4d4d, #ffb84d, #ffd54d, #4de0ff);
  --bg:#0b0b0f;
  --panel:rgba(255,255,255,0.04);
  --glass:rgba(255,255,255,0.03);
}
*{box-sizing:border-box;font-family:Inter,Arial,Helvetica,sans-serif}
html,body{height:100%;margin:0;background:radial-gradient(circle at 10% 10%, #07112a 0%, #050509 50%),var(--bg); color:#fff;}
header{
  position:fixed; top:0; left:0; right:0; height:64px; display:flex; align-items:center; justify-content:space-between;
  padding:8px 12px; gap:12px; backdrop-filter:blur(6px); background:linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.35));
  border-bottom:1px solid rgba(255,255,255,0.03); z-index:1000;
}
.title{font-weight:700;font-size:18px;display:flex;gap:10px;align-items:center;}
.header-right{display:flex;gap:10px;align-items:center;}
#coinBig{background:var(--panel); padding:8px 12px; border-radius:10px; font-weight:700; color:gold; min-width:110px; text-align:center;}
#restartHeaderBtn,#startBtn,#homeBtn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700;}
#restartHeaderBtn{background:var(--glass);}
#startBtn,#homeBtn{background:var(--panel); color:#fff;}
main{padding-top:78px;display:flex;gap:12px;align-items:flex-start;justify-content:center;width:100%;}
.game-wrap{width:100%;max-width:1000px;display:flex;flex-direction:column;align-items:center;gap:10px;padding:10px;}
canvas{background:linear-gradient(180deg,#07101a,#0b0b0f);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.6);width:100%;height:auto;display:block;}
.controls{display:flex;gap:10px;justify-content:center;width:100%;margin-top:6px;}
.ctrl-btn{flex:1;max-width:120px;padding:14px;border-radius:12px;font-size:20px;border:none;cursor:pointer;background:linear-gradient(90deg,#222,#111);color:#fff;touch-action:none;user-select:none}
.ctrl-btn.big{flex:2;max-width:240px}
.sidebar{width:320px;max-width:36%;min-width:260px;display:flex;flex-direction:column;gap:12px;padding:8px}
.panel{background:var(--panel);padding:10px;border-radius:12px;min-height:60px;overflow:hidden;}
.panel h3{margin:0 0 8px 0;font-size:16px}
#leaderboard ol{padding-left:18px;margin:0;max-height:250px;overflow:auto;}
#leaderboard li{padding:6px 8px;border-radius:8px;margin-bottom:6px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent)}
.highest{color:#0ff;font-weight:800;border-left:4px solid #0ff;padding-left:6px;}
.muted{opacity:0.7;font-size:13px;}
#gameOverPopup{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%) scale(0);background:rgba(0,0,0,0.9);padding:20px;border-radius:12px;z-index:2000;min-width:260px;text-align:center;transition:all .18s ease;}
#gameOverPopup.show{transform:translate(-50%,-50%) scale(1);}
#gameOverPopup button{margin-top:8px;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;}
</style>
</head>
<body>

<header>
<div class="title"><div>GBG Infinite Runner</div><div class="muted">‚Äî Play & Compete</div></div>
<div class="header-right">
<div id="coinBig">Coins: <span id="coinCount">0</span></div>
<button id="startBtn">Play Now</button>
<button id="restartHeaderBtn" title="Restart Game">üîÑ Restart</button>
<button id="homeBtn">üè† Home</button>
</div>
</header>

<main>
<div class="game-wrap">
<canvas id="gameCanvas" width="900" height="420"></canvas>
<div class="controls" id="mobileControls">
<button class="ctrl-btn" id="leftBtn">‚¨ÖÔ∏è</button>
<button class="ctrl-btn big" id="jumpBtn">‚¨ÜÔ∏è Jump</button>
<button class="ctrl-btn" id="rightBtn">‚û°Ô∏è</button>
<button class="ctrl-btn" id="pauseBtn">‚è∏Ô∏è</button>
<button class="ctrl-btn" id="restartBtn">üîÑ</button>
</div>
<div id="infoLine" class="muted" style="text-align:center;margin-top:6px">Use touch or Arrow keys.</div>
</div>

<aside class="sidebar">
<div class="panel" id="leaderboard">
<h3>Leaderboard (Top 100)</h3>
<ol id="scoreList"></ol>
<div class="muted">Highest score highlighted per country/state.</div>
</div>
</aside>
</main>

<div id="gameOverPopup">
<h2 id="goTitle">Game Over</h2>
<p id="finalScore">You scored: 0</p>
<div style="display:flex; gap:8px; justify-content:center">
<button id="playAgainBtn">Play Again</button>
<button id="closePopupBtn">Close</button>
</div>
</div>

<script>
/* ------------------------- Variables ------------------------- */
const canvas=document.getElementById('gameCanvas'); const ctx=canvas.getContext('2d');
let w=canvas.width,h=canvas.height;
function resizeCanvas(){const maxWidth=Math.min(window.innerWidth-24,1000);canvas.style.width=maxWidth+'px';const deviceRatio=window.devicePixelRatio||1;const styleWidth=maxWidth;const styleHeight=Math.floor(styleWidth*420/900);canvas.width=Math.floor(styleWidth*deviceRatio);canvas.height=Math.floor(styleHeight*deviceRatio);canvas.style.height=styleHeight+'px';canvas.getContext('2d').scale(deviceRatio,deviceRatio);w=styleWidth;h=styleHeight;}
window.addEventListener('resize',()=>{resizeCanvas(); draw();}); resizeCanvas();

/* Game state */
let gameStarted=false,paused=false,speed=6,scrollSpeed=2,enemySpeed=2.5,scoreThisRun=0,playerCoins=0;
let highScores=JSON.parse(localStorage.getItem('highScores')||'[]'); 
let playerName=null,playerCountry=null,playerState=null,invincible=false,jumpStrength=12;

document.getElementById('coinCount').innerText=playerCoins;

/* Entities */
let player={x:120,y:0,w:48,h:48,vy:0,onGround:false};
let coins=[],enemies=[];
const coinSize=18,enemySize=38;

/* Controls */
const keys={};
window.addEventListener('keydown',e=>{keys[e.key]=true;if(e.key===' '){e.preventDefault();}});
window.addEventListener('keyup',e=>{keys[e.key]=false;});

/* Mobile buttons */
const leftBtn=document.getElementById('leftBtn'),rightBtn=document.getElementById('rightBtn'),
jumpBtn=document.getElementById('jumpBtn'),pauseBtn=document.getElementById('pauseBtn'),
restartBtn=document.getElementById('restartBtn'),restartHeaderBtn=document.getElementById('restartHeaderBtn'),
homeBtn=document.getElementById('homeBtn');

function touchSet(key,isDown){return ev=>{ev.preventDefault();keys[key]=isDown;}}
leftBtn.addEventListener('touchstart',touchSet('ArrowLeft',true)); leftBtn.addEventListener('touchend',touchSet('ArrowLeft',false));
rightBtn.addEventListener('touchstart',touchSet('ArrowRight',true)); rightBtn.addEventListener('touchend',touchSet('ArrowRight',false));
jumpBtn.addEventListener('touchstart',e=>{e.preventDefault();doJump();},{passive:false});
pauseBtn.addEventListener('click',()=>togglePause());
restartBtn.addEventListener('click',()=>restartGame());
restartHeaderBtn.addEventListener('click',()=>restartGame());
homeBtn.addEventListener('click',()=>{window.location.href='index.html';});

/* ------------------------- Start Game ------------------------- */
document.getElementById('startBtn').addEventListener('click',()=>{
  if(!playerName){
    let name=null,country=null,state=null;
    while(!name){name=prompt('Enter your unique name (no spaces recommended):')||null;}
    while(!country){country=prompt('Enter your country:')||null;}
    while(!state){state=prompt('Enter your state:')||null;}
    name=name.trim().slice(0,20);
    // check duplicate
    const exists=highScores.find(h=>h.name===name && h.country===country && h.state===state);
    if(exists){alert('Name already exists for this country/state. Pick another.'); return;}
    playerName=name; playerCountry=country; playerState=state;
    localStorage.setItem('playerName',playerName); localStorage.setItem('playerCountry',playerCountry); localStorage.setItem('playerState',playerState);
  }
  startGame();
});

/* Jump */
function doJump(){if(player.onGround){player.vy=-jumpStrength;player.onGround=false;}}

/* Spawn helpers */
function spawnCoin(y){const x=Math.random()*(w-coinSize-20)+10;const yy=typeof y==='number'?y:-Math.random()*h*0.6;coins.push({x,y:yy});}
function spawnEnemy(y){const x=Math.random()*(w-enemySize-20)+10;const yy=typeof y==='number'?y:-Math.random()*h*0.8;enemies.push({x,y:yy,w:enemySize,h:enemySize});}
function spawnInitial(){coins=[];enemies=[];for(let i=0;i<8;i++)spawnCoin(-Math.random()*h*2);for(let i=0;i<4;i++)spawnEnemy(-Math.random()*h*2);}

/* Game Loop */
const gravity=0.8;
function update(){
if(!gameStarted||paused)return;
// controls
if(keys['ArrowLeft']||keys['a'])player.x-=speed;
if(keys['ArrowRight']||keys['d'])player.x+=speed;
if(keys['ArrowUp']||keys['w']){doJump();keys['ArrowUp']=false;}
// bounds
if(player.x<6)player.x=6;
if(player.x+player.w>w-6)player.x=w-6-player.w;
// vertical physics
player.vy+=gravity;player.y+=player.vy;
if(player.y+player.h>=h-10){player.y=h-10-player.h;player.vy=0;player.onGround=true;}else{player.onGround=false;}
// coins
for(let i=coins.length-1;i>=0;i--){
coins[i].y+=scrollSpeed+1;
if(coins[i].y>h+40){coins.splice(i,1);spawnCoin();}
else if(collideRect(player.x,player.y,player.w,player.h,coins[i].x,coins[i].y,coinSize,coinSize)){
coins.splice(i,1);scoreThisRun++;spawnCoin(-50);
}}
for(let i=enemies.length-1;i>=0;i--){
enemies[i].y+=enemySpeed;
if(enemies[i].y>h+60){enemies.splice(i,1);spawnEnemy(-Math.random()*h*0.5);}
else if(!invincible&&collideRect(player.x,player.y,player.w,player.h,enemies[i].x,enemies[i].y,enemies[i].w,enemies[i].h)){endGame();}
}}

function draw(){
ctx.clearRect(0,0,w,h);
// background gradient
let grd=ctx.createLinearGradient(0,0,0,h);
grd.addColorStop(0,'#07112a');grd.addColorStop(1,'#0b0b0f');ctx.fillStyle=grd;ctx.fillRect(0,0,w,h);
// coins
ctx.fillStyle='gold';
coins.forEach(c=>ctx.fillRect(c.x,c.y,coinSize,coinSize));
// enemies
ctx.fillStyle='red';
enemies.forEach(e=>ctx.fillRect(e.x,e.y,e.w,e.h));
// player
ctx.fillStyle='cyan';
ctx.fillRect(player.x,player.y,player.w,player.h);
// score
ctx.fillStyle='#fff';ctx.font='18px Arial';ctx.fillText('Score: '+scoreThisRun,10,22);
ctx.fillText('Coins: '+playerCoins,10,44);
}

/* Collision */
function collideRect(x1,y1,w1,h1,x2,y2,w2,h2){return!(x1>w2+x2||x1+w1<x2||y1>y2+h2||y1+h1<y2);}

/* Game Loop */
function gameLoop(){update();draw();requestAnimationFrame(gameLoop);}
gameLoop();

/* Start / Restart */
function startGame(){gameStarted=true;scoreThisRun=0;spawnInitial();document.getElementById('gameOverPopup').classList.remove('show');}
function restartGame(){scoreThisRun=0;player.x=120;player.y=0;player.vy=0;spawnInitial();paused=false;gameStarted=false;playerCoins=0;document.getElementById('coinCount').innerText=playerCoins;document.getElementById('gameOverPopup').classList.remove('show');}

/* Pause */
function togglePause(){paused=!paused;}

/* End Game */
function endGame(){gameStarted=false;playerCoins+=scoreThisRun;document.getElementById('coinCount').innerText=playerCoins;
document.getElementById('finalScore').innerText='You scored: '+scoreThisRun;showLeaderboard();document.getElementById('gameOverPopup').classList.add('show');}

/* Popup buttons */
document.getElementById('playAgainBtn').addEventListener('click',()=>{startGame();});
document.getElementById('closePopupBtn').addEventListener('click',()=>{document.getElementById('gameOverPopup').classList.remove('show');});

/* Leaderboard */
function showLeaderboard(){
  if(!playerName)return;
  // Save
  highScores.push({name:playerName,country:playerCountry,state:playerState,score:scoreThisRun,coins:playerCoins});
  // Sort top by score
  highScores.sort((a,b)=>b.score-a.score);
  if(highScores.length>100)highScores.length=100;
  localStorage.setItem('highScores',JSON.stringify(highScores));
  const ol=document.getElementById('scoreList'); ol.innerHTML='';
  highScores.forEach((h,i)=>{
    const li=document.createElement('li');
    li.textContent=`${i+1}. ${h.name} (${h.country}, ${h.state}) - Score: ${h.score} Coins: ${h.coins}`;
    if(i===0)li.classList.add('highest');
    ol.appendChild(li);
  });
}
</script>

</body>
</html>
