<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GBG Infinite Runner - Final</title>
<style>
:root{
  --accent: linear-gradient(90deg, #ff4d4d, #ffb84d, #ffd54d, #4de0ff);
  --bg:#0b0b0f;
  --panel: rgba(255,255,255,0.05);
  --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box;font-family:Inter,Arial,sans-serif;}
html,body{height:100%;margin:0;background:radial-gradient(circle at 10% 10%,#07112a 0%,#050509 50%),var(--bg);color:#fff;}
header{position:fixed;top:0;left:0;right:0;height:64px;display:flex;align-items:center;justify-content:space-between;padding:8px 12px;gap:12px;backdrop-filter:blur(6px);background:linear-gradient(180deg,rgba(0,0,0,0.55),rgba(0,0,0,0.35));border-bottom:1px solid rgba(255,255,255,0.03);z-index:1000;}
.title{font-weight:700;font-size:18px;display:flex;gap:10px;align-items:center;}
.header-right{display:flex;gap:10px;align-items:center;}
#coinBig{background:var(--panel);padding:8px 12px;border-radius:10px;font-weight:700;color:gold;min-width:110px;text-align:center;}
#restartHeaderBtn,#startBtn,#homeBtn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700;}
#restartHeaderBtn{background:var(--glass);}
#startBtn{background:var(--panel);color:#fff;}
#homeBtn{background:linear-gradient(90deg,#ff4d4d,#4de0ff);color:#fff;}
main{padding-top:78px;display:flex;gap:12px;align-items:flex-start;justify-content:center;width:100%;}
.game-wrap{width:100%;max-width:1000px;display:flex;flex-direction:column;align-items:center;gap:10px;padding:10px;}
canvas{background:linear-gradient(180deg,#07101a,#0b0b0f);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.6);width:100%;height:auto;display:block;}
.controls{display:flex;gap:10px;justify-content:center;width:100%;margin-top:6px;}
.ctrl-btn{flex:1;max-width:120px;padding:14px;border-radius:12px;font-size:20px;border:none;cursor:pointer;background:linear-gradient(90deg,#222,#111);color:#fff;touch-action:none;user-select:none;}
.ctrl-btn.big{flex:2;max-width:240px;}
.sidebar{width:320px;max-width:36%;min-width:260px;display:flex;flex-direction:column;gap:12px;padding:8px;}
.panel{background:var(--panel);padding:10px;border-radius:12px;min-height:60px;overflow:hidden;}
.panel h3{margin:0 0 8px 0;font-size:16px;}
#leaderboard ol{padding-left:18px;margin:0;max-height:250px;overflow:auto;}
#leaderboard li{padding:6px 8px;border-radius:8px;margin-bottom:6px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);}
.highest{color:#0ff;font-weight:800;border-left:4px solid #0ff;padding-left:6px;}
#commandPrompt{display:flex;flex-direction:column;gap:6px;}
#cmdInput{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff;}
#commandLog{max-height:160px;overflow:auto;font-family:monospace;font-size:13px;padding:6px;background:rgba(0,0,0,0.12);border-radius:8px;}
#gameOverPopup{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%) scale(0);background:rgba(0,0,0,0.9);padding:20px;border-radius:12px;z-index:2000;min-width:260px;text-align:center;transition:all .18s ease;}
#gameOverPopup.show{transform:translate(-50%,-50%) scale(1);}
#gameOverPopup button{margin-top:8px;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;}
@media(max-width:900px){.sidebar{position:fixed;right:10px;top:84px;width:290px;z-index:900;max-height:60vh;overflow:auto;}main{padding-bottom:120px;}}
@media(max-width:600px){header{height:72px;padding:10px 12px}.controls{position:fixed;left:10px;right:10px;bottom:12px;z-index:1000}.sidebar{display:none}.game-wrap{padding-bottom:80px;}}
.muted{opacity:0.7;font-size:13px;}
.flexrow{display:flex;align-items:center;gap:8px;}
</style>
</head>
<body>

<header>
  <div class="title">
    <div>GBG Infinite Runner</div>
    <div class="muted">‚Äî Play & Compete</div>
  </div>

  <div class="header-right">
    <div id="coinBig">Coins: <span id="coinCount">0</span></div>
    <button id="startBtn">Play Now</button>
    <button id="restartHeaderBtn" title="Restart Game">üîÑ Restart</button>
    <button id="homeBtn">üè† Home</button>
  </div>
</header>

<main>
  <div class="game-wrap">
    <canvas id="gameCanvas" width="900" height="420"></canvas>
    <div class="controls" id="mobileControls" aria-hidden="false">
      <button class="ctrl-btn" id="leftBtn">‚¨ÖÔ∏è</button>
      <button class="ctrl-btn big" id="jumpBtn">‚¨ÜÔ∏è Jump</button>
      <button class="ctrl-btn" id="rightBtn">‚û°Ô∏è</button>
      <button class="ctrl-btn" id="pauseBtn">‚è∏Ô∏è</button>
      <button class="ctrl-btn" id="restartBtn">üîÑ</button>
    </div>
    <div id="infoLine" class="muted" style="text-align:center;margin-top:6px">Use touch or Arrow keys. Enter info on Play.</div>
  </div>

  <aside class="sidebar">
    <div class="panel" id="leaderboard">
      <h3>Leaderboard (India Top 100)</h3>
      <ol id="scoreList"></ol>
      <div style="margin-top:8px" class="muted">Highest score highlighted.</div>
    </div>

    <div class="panel" id="coinsPanel">
      <h3>Your Coins</h3>
      <div id="homeCoinDisplay" style="font-size:20px;font-weight:700">You have <span id="homeCoins">0</span> coins</div>
      <div style="margin-top:8px" class="muted">Coins persist between sessions.</div>
    </div>
  </aside>
</main>

<div id="gameOverPopup">
  <h2 id="goTitle">Game Over</h2>
  <p id="finalScore">You scored: 0</p>
  <div style="display:flex;gap:8px;justify-content:center">
    <button id="playAgainBtn">Play Again</button>
    <button id="closePopupBtn">Close</button>
  </div>
</div>

<script>
/* -------------------------
 Variables & persistence
------------------------- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let w=canvas.width,h=canvas.height;

function resizeCanvas(){
  const maxWidth=Math.min(window.innerWidth-24,1000);
  canvas.style.width=maxWidth+'px';
  const deviceRatio=window.devicePixelRatio||1;
  const styleWidth=maxWidth;
  const styleHeight=Math.floor(styleWidth*420/900);
  canvas.width=Math.floor(styleWidth*deviceRatio);
  canvas.height=Math.floor(styleHeight*deviceRatio);
  canvas.style.height=styleHeight+'px';
  ctx.scale(deviceRatio,deviceRatio);
  w=styleWidth; h=styleHeight;
}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

/* Game state */
let gameStarted=false,paused=false,speed=6,scrollSpeed=2,enemySpeed=2.5,scoreThisRun=0,playerCoins=0,jumpStrength=12,invincible=false;
let playerName=localStorage.getItem('playerName')||null;
let playerCountry=localStorage.getItem('playerCountry')||null;
let playerState=localStorage.getItem('playerState')||null;
let highScores=JSON.parse(localStorage.getItem('highScores')||'[]');

document.getElementById('coinCount').innerText=playerCoins;
document.getElementById('homeCoins').innerText=playerCoins;

/* Entities */
let player={x:120,y:0,w:48,h:48,vy:0,onGround:false};
let coins=[],enemies=[];
const coinSize=18,enemySize=38;

/* Controls */
const keys={};
window.addEventListener('keydown',e=>{keys[e.key]=true;if(e.key===' '){e.preventDefault();}});
window.addEventListener('keyup',e=>{keys[e.key]=false;});

/* Mobile buttons */
function touchSet(key,isDown){return ev=>{ev.preventDefault();keys[key]=isDown;}}
document.getElementById('leftBtn').addEventListener('touchstart',touchSet('ArrowLeft',true));
document.getElementById('leftBtn').addEventListener('touchend',touchSet('ArrowLeft',false));
document.getElementById('rightBtn').addEventListener('touchstart',touchSet('ArrowRight',true));
document.getElementById('rightBtn').addEventListener('touchend',touchSet('ArrowRight',false));
document.getElementById('jumpBtn').addEventListener('touchstart',e=>{e.preventDefault();doJump();},{passive:false});
document.getElementById('pauseBtn').addEventListener('click',()=>togglePause());
document.getElementById('restartBtn').addEventListener('click',()=>restartGame());
document.getElementById('restartHeaderBtn').addEventListener('click',()=>restartGame());
document.getElementById('homeBtn').addEventListener('click',()=>{window.location.href='index.html';});

/* -------------------------
 Start / Play
------------------------- */
document.getElementById('startBtn').addEventListener('click',()=>{
  if(!playerName||!playerCountry||!playerState){
    askPlayerInfo();
  } else {
    startGame();
  }
});

function askPlayerInfo(){
  let name='',country='',state='';
  while(true){
    name=prompt('Enter your unique name:')||'';
    name=name.trim().slice(0,20);
    if(!name) continue;
    if(highScores.find(h=>h.name===name)){alert('Name already taken! Choose another.'); continue;}
    break;
  }
  country=prompt('Enter your country:')||'Unknown';
  state=prompt('Enter your state:')||'Unknown';
  playerName=name; playerCountry=country; playerState=state;
  localStorage.setItem('playerName',playerName);
  localStorage.setItem('playerCountry',playerCountry);
  localStorage.setItem('playerState',playerState);
  startGame();
}

/* -------------------------
 Game Functions
------------------------- */
function spawnCoin(y){const x=Math.random()*(w-coinSize-20)+10;const yy=typeof y==='number'?y:-Math.random()*h*0.6;coins.push({x,y:yy});}
function spawnEnemy(y){const x=Math.random()*(w-enemySize-20)+10;const yy=typeof y==='number'?y:-Math.random()*h*0.8;enemies.push({x,y:yy,w:enemySize,h:enemySize});}

function doJump(){if(player.onGround){player.vy=-jumpStrength;player.onGround=false;}}
function togglePause(){paused=!paused;}

/* -------------------------
 Game Loop
------------------------- */
function update(){
  if(!gameStarted||paused) return;
  // Gravity
  player.vy+=0.7;
  player.y+=player.vy;
  if(player.y+h*0.25>h){player.y=h-player.h;player.vy=0;player.onGround=true;}

  // Horizontal
  if(keys.ArrowLeft) player.x-=speed;
  if(keys.ArrowRight) player.x+=speed;
  if(player.x<0) player.x=0;
  if(player.x+w>w) player.x=w-player.w;

  // Coin collection
  coins.forEach((c,i)=>{
    if(c.x<player.x+player.w && c.x+coinSize>player.x && c.y<player.y+player.h && c.y+coinSize>player.y){
      playerCoins++; coins.splice(i,1);
      document.getElementById('coinCount').innerText=playerCoins;
      document.getElementById('homeCoins').innerText=playerCoins;
    }
    c.y+=scrollSpeed;
  });

  // Enemy collision
  enemies.forEach((e,i)=>{
    e.y+=enemySpeed;
    if(e.x<player.x+player.w && e.x+e.w>player.x && e.y<player.y+player.h && e.y+e.h>player.y && !invincible){
      gameOver();
    }
  });

  // Score
  scoreThisRun+=0.1;

  // Spawn random coins & enemies
  if(Math.random()<0.015) spawnCoin();
  if(Math.random()<0.01) spawnEnemy();

  draw();
  requestAnimationFrame(update);
}

/* -------------------------
 Draw
------------------------- */
function draw(){
  ctx.clearRect(0,0,w,h);
  // Player
  ctx.fillStyle='#0ff';
  ctx.fillRect(player.x,player.y,player.w,player.h);
  // Coins
  coins.forEach(c=>{ctx.fillStyle='gold';ctx.fillRect(c.x,c.y,coinSize,coinSize);});
  // Enemies
  enemies.forEach(e=>{ctx.fillStyle='red';ctx.fillRect(e.x,e.y,e.w,e.h);});
  // Score
  ctx.fillStyle='#fff';
  ctx.font='18px Arial';
  ctx.fillText('Score: '+Math.floor(scoreThisRun),10,24);
}

/* -------------------------
 Game Over
------------------------- */
function gameOver(){
  gameStarted=false;
  showGameOverPopup();
  saveScore();
}

function showGameOverPopup(){
  document.getElementById('finalScore').innerText='You scored: '+Math.floor(scoreThisRun);
  document.getElementById('gameOverPopup').classList.add('show');
}
document.getElementById('playAgainBtn').addEventListener('click',()=>{document.getElementById('gameOverPopup').classList.remove('show');restartGame();});
document.getElementById('closePopupBtn').addEventListener('click',()=>{document.getElementById('gameOverPopup').classList.remove('show');});

/* -------------------------
 Restart
------------------------- */
function restartGame(){
  coins=[];enemies=[];
  player.x=120;player.y=0;player.vy=0;player.onGround=false;
  scoreThisRun=0;gameStarted=true;paused=false;
  update();
}

/* -------------------------
 Start Game
------------------------- */
function startGame(){
  if(!gameStarted){
    gameStarted=true;
    restartGame();
  }
}

/* -------------------------
 Leaderboard
------------------------- */
function saveScore(){
  highScores.push({name:playerName,country:playerCountry,state:playerState,score:Math.floor(scoreThisRun)});
  localStorage.setItem('highScores',JSON.stringify(highScores));
  renderLeaderboard();
}
function renderLeaderboard(){
  const list=document.getElementById('scoreList');
  list.innerHTML='';
  const indiaScores=highScores.filter(h=>h.country.toLowerCase()==='india').sort((a,b)=>b.score-a.score).slice(0,100);
  indiaScores.forEach((p,i)=>{
    const li=document.createElement('li');
    li.textContent=`${i+1}. ${p.name} [${p.state}] - ${p.score}`;
    if(i===0) li.classList.add('highest');
    list.appendChild(li);
  });
}

/* -------------------------
 Init
------------------------- */
renderLeaderboard();
</script>

</body>
</html>
