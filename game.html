<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GBG Ultimate Car Game</title>
<style>
body {margin:0; overflow:hidden; font-family:Arial,sans-serif; background:#111;}
canvas{display:block; margin:auto; background:#1a1a1a;}
#startBtn, #settingsBtn {position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); padding:15px 30px; font-size:22px; border:none; border-radius:10px; cursor:pointer; background: linear-gradient(90deg, red,orange,yellow,green,cyan,blue,violet,red); color:white; animation: rgbMove 6s linear infinite;}
@keyframes rgbMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
#controls {position:absolute; bottom:20px; width:100%; text-align:center;}
.controlBtn {padding:15px 25px; margin:0 20px; font-size:20px; border:none; border-radius:10px; background: rgba(255,255,255,0.2); color:white; cursor:pointer;}
#cmdBox {position:absolute; left:10px; top:10px; width:220px; height:90%; background:rgba(0,0,0,0.7); overflow-y:auto; padding:10px; border-radius:10px; color:#0f0; font-family:monospace; font-size:14px;}
#leaderboard {position:absolute; right:10px; top:10px; width:180px; height:90%; background:rgba(0,0,0,0.7); overflow-y:auto; padding:10px; border-radius:10px; color:#ff0; font-family:monospace; font-size:14px;}
</style>
</head>
<body>

<canvas id="game" width="800" height="500"></canvas>
<button id="startBtn">üö¶ Start Game</button>
<div id="controls">
  <button class="controlBtn" id="leftBtn">‚¨ÖÔ∏è Left</button>
  <button class="controlBtn" id="rightBtn">‚û°Ô∏è Right</button>
</div>

<div id="cmdBox">
<h3>Command Prompt</h3>
<p>Type commands: speed 5, coins 100, invisible, height 50</p>
<input type="text" id="cmdInput" placeholder="// Enter command" style="width:100%; border:none; border-radius:5px; padding:5px;">
<button onclick="runCommand()" style="width:100%; margin-top:5px;">Run</button>
<div id="cmdOutput"></div>
</div>

<div id="leaderboard">
<h3>Leaderboard</h3>
<ul id="leaderboardList"></ul>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Game state
let gameStarted = false;
let score = 0;
let coins = 0;
let speed = 5;
let carHeight = 50;
let invisible = false;

// Player car
const player = {x:350, y:canvas.height-100, w:50, h:50};

// Obstacles
let obstacles = [];
let coinsArr = [];

// Controls
let moveLeft = false;
let moveRight = false;

// Leaderboard
let leaderboard = [];

// Start Game
document.getElementById("startBtn").addEventListener("click", () => {
  resetGame();
  gameStarted = true;
  document.getElementById("startBtn").style.display = "none";
  requestAnimationFrame(gameLoop);
});

// Mobile buttons
document.getElementById("leftBtn").addEventListener("mousedown", ()=>{moveLeft=true});
document.getElementById("leftBtn").addEventListener("mouseup", ()=>{moveLeft=false});
document.getElementById("rightBtn").addEventListener("mousedown", ()=>{moveRight=true});
document.getElementById("rightBtn").addEventListener("mouseup", ()=>{moveRight=false});

// Keyboard
window.addEventListener("keydown", e=>{
  if(e.code==="ArrowLeft") moveLeft=true;
  if(e.code==="ArrowRight") moveRight=true;
});
window.addEventListener("keyup", e=>{
  if(e.code==="ArrowLeft") moveLeft=false;
  if(e.code==="ArrowRight") moveRight=false;
});

// Voice commands
if('webkitSpeechRecognition' in window){
  const recognition = new webkitSpeechRecognition();
  recognition.continuous=true;
  recognition.onresult = function(event){
    const voice = event.results[event.results.length-1][0].transcript.trim().toLowerCase();
    if(voice.includes("left")) moveLeft=true; if(voice.includes("right")) moveRight=true;
    setTimeout(()=>{moveLeft=false; moveRight=false}, 500);
  }
  recognition.start();
}

// Command prompt
function runCommand(){
  const cmd = document.getElementById("cmdInput").value.trim().toLowerCase();
  const output = document.getElementById("cmdOutput");
  if(cmd.startsWith("speed")){
    const val = parseInt(cmd.split(" ")[1]);
    if(!isNaN(val)){ speed = val; output.innerHTML="Speed set to "+speed; }
  }else if(cmd.startsWith("coins")){
    const val = parseInt(cmd.split(" ")[1]);
    if(!isNaN(val)){ coins += val; output.innerHTML="Coins increased by "+val; }
  }else if(cmd==="invisible"){ invisible=true; output.innerHTML="Car is now invisible"; }
  else if(cmd==="visible"){ invisible=false; output.innerHTML="Car visible again"; }
  else if(cmd.startsWith("height")){
    const val = parseInt(cmd.split(" ")[1]);
    if(!isNaN(val)){ carHeight=val; output.innerHTML="Car height set to "+carHeight; player.h=carHeight; }
  }else{
    output.innerHTML="Unknown command";
  }
}

// Generate obstacle
function genObstacle(){
  const width = 50+Math.random()*50;
  const x = Math.random()*(canvas.width-width);
  obstacles.push({x:x, y:-50, w:width, h:20});
}

// Generate coin
function genCoin(){
  const x = Math.random()*(canvas.width-20);
  coinsArr.push({x:x, y:-20, w:20, h:20});
}

// Reset Game
function resetGame(){
  score=0; coins=0; obstacles=[]; coinsArr=[]; player.x=350; player.y=canvas.height-100;
}

// Leaderboard update
function updateLeaderboard(){
  const lb = document.getElementById("leaderboardList");
  lb.innerHTML="";
  leaderboard.sort((a,b)=>b.score-a.score);
  leaderboard.slice(0,10).forEach(p=>{
    lb.innerHTML+="<li>"+p.name+" - "+p.score+"</li>";
  });
}

// Game loop
let frames=0;
function gameLoop(){
  if(!gameStarted) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Move player
  if(moveLeft) player.x-=speed;
  if(moveRight) player.x+=speed;
  if(player.x<0) player.x=0;
  if(player.x+player.w>canvas.width) player.x=canvas.width-player.w;

  // Generate obstacles & coins
  frames++;
  if(frames%60===0) genObstacle();
  if(frames%100===0) genCoin();

  // Move obstacles
  obstacles.forEach(o=>{ o.y+=speed; ctx.fillStyle="red"; ctx.fillRect(o.x,o.y,o.w,o.h); });
  obstacles = obstacles.filter(o=>o.y<canvas.height);

  // Move coins
  coinsArr.forEach(c=>{ c.y+=speed; ctx.fillStyle="yellow"; ctx.fillRect(c.x,c.y,c.w,c.h); });
  coinsArr = coinsArr.filter(c=>c.y<canvas.height);

  // Collision with obstacles
  for(let o of obstacles){
    if(player.x<o.x+o.w && player.x+player.w>o.x && player.y<o.y+o.h && player.y+player.h>o.y){
      gameStarted=false;
      alert("Game Over!\nScore: "+score+"\nCoins: "+coins);
      // Save leaderboard
      const name = prompt("Enter your name for leaderboard:") || "Guest";
      leaderboard.push({name:name, score:coins});
      updateLeaderboard();
      document.getElementById("startBtn").style.display="block";
      return;
    }
  }

  // Collision with coins
  for(let i=coinsArr.length-1;i>=0;i--){
    const c=coinsArr[i];
    if(player.x<c.x+c.w && player.x+player.w>c.x && player.y<c.y+c.h && player.y+player.h>c.y){
      coins++; coinsArr.splice(i,1);
    }
  }

  // Draw player
  if(!invisible){ ctx.fillStyle="cyan"; ctx.fillRect(player.x,player.y,player.w,player.h); }

  // Score & coins
  ctx.fillStyle="white"; ctx.font="20px Arial";
  ctx.fillText("Coins: "+coins, 10, 30);
  ctx.fillText("Score: "+score, 10, 60);

  // Increment score
  score++;

  requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
