<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GBG Settings ‚Äî Ultimate (100 Options)</title>
  <style>
    :root{
      --bg:#000;
      --card-bg: rgba(0,0,0,0.55);
      --glass: rgba(255,255,255,0.03);
      --accent: linear-gradient(90deg,#ff004c,#ff8a00,#ffe600,#00ff99,#00d2ff,#7b5cff);
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; font-family:Inter, Arial, Helvetica, sans-serif; background:var(--bg); color:#fff}
    .wrap{max-width:1200px; margin:18px auto; padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px;border-radius:10px;background:linear-gradient(90deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));box-shadow:0 10px 30px rgba(0,0,0,0.6)}
    .logo{font-weight:900; font-size:20px; background:var(--accent); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-size:400%; animation:rgbShift 8s linear infinite}
    .homeBtn{padding:8px 12px;background:rgba(255,255,255,0.06);border-radius:8px;color:#fff;text-decoration:none;font-weight:700}
    .homeBtn:hover{filter:brightness(1.1)}
    @keyframes rgbShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

    .intro{margin-top:12px}
    .intro h1{margin:6px 0;font-size:24px}
    .intro p{color:#cdd;margin:4px 0 12px}

    /* grid */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
    .card{background:var(--card-bg);border-radius:12px;padding:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03);position:relative;overflow:hidden}
    .card .title{font-weight:800;margin-bottom:8px}
    .muted{color:#bcd;font-size:13px;margin-bottom:8px}

    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:8px 12px;border-radius:8px;border:none;background:rgba(255,255,255,0.06);color:#fff;cursor:pointer;font-weight:800;transition:all .12s}
    .btn:hover{transform:translateY(-2px)}
    .btn.small{padding:6px 8px;font-size:13px}
    .on{background:var(--accent);color:#000}
    .off{background:rgba(255,255,255,0.05);color:#ddd;border:1px solid rgba(255,255,255,0.03)}

    .range{width:100%}
    .status{color:#bcd;font-size:13px;margin-top:8px}

    /* preview */
    .preview{margin-top:14px;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));display:flex;gap:12px;align-items:center;justify-content:space-between}
    .preview .box{width:48%;padding:10px;background:rgba(0,0,0,0.45);border-radius:8px}

    /* fancy watermark, particles, moon, water, smoke */
    .gbg_watermark{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);font-size:10rem;color:rgba(255,255,255,0.03);pointer-events:none;z-index:0}
    .particle { position:fixed; border-radius:50%; pointer-events:none; mix-blend-mode:screen; z-index:0; opacity:0.8 }
    .moon { position:fixed; right:5%; top:8%; width:140px; height:140px; border-radius:50%; box-shadow:0 0 60px rgba(255,255,255,0.06); z-index:0; pointer-events:none }
    .waterRipple { position:fixed; left:0; right:0; bottom:-10%; height:40%; z-index:0; pointer-events:none; opacity:0.12; background: radial-gradient(circle at center, rgba(0,255,200,0.06), rgba(0,0,0,0)); backdrop-filter: blur(6px); }

    /* smoke */
    .smoke { position:fixed; bottom:6%; left:8%; width:120px; height:120px; pointer-events:none; z-index:0; opacity:0.8; }
    .smoke span { position:absolute; width:40px; height:40px; background: radial-gradient(circle, rgba(200,200,200,0.08), rgba(0,0,0,0)); border-radius:50%; animation:smokeUp 5s linear infinite; }
    .smoke span:nth-child(1){left:10px; animation-delay:0s}
    .smoke span:nth-child(2){left:40px; animation-delay:0.6s}
    .smoke span:nth-child(3){left:70px; animation-delay:1.2s}
    @keyframes smokeUp { 0% {transform: translateY(0) scale(0.6); opacity:0.8} 60% {opacity:0.45} 100% {transform: translateY(-160px) scale(1.5); opacity:0} }

    /* footer */
    footer{margin-top:18px;text-align:center;color:#9ff;opacity:0.9;padding-bottom:18px}

    /* responsive */
    @media (max-width:520px){ .preview{flex-direction:column} .preview .box{width:100%} }
  </style>
</head>
<body>

  <div class="wrap">
    <header>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="logo">GBG ‚Ä¢ Settings</div>
        <div style="color:#bcd;font-size:13px">Ultimate Panel ‚Äî 100 options</div>
      </div>
      <div style="display:flex;gap:10px;align-items:center">
        <a class="homeBtn" href="index.html">üè† Home</a>
        <button id="playDemoChant" class="btn small">üîä Test Chant</button>
      </div>
    </header>

    <div class="intro">
      <h1 class="logo">GBG ‚Ä¢ Ultimate Settings</h1>
      <p class="muted">100 grouped options (10 categories √ó 10) ‚Äî all saved to localStorage and apply across pages. RGB UI, stars, moon, water, smoke and click-chant (Jai Shri Ram) implemented.</p>
    </div>

    <!-- preview -->
    <div class="preview card">
      <div class="box">
        <div style="font-weight:800;font-size:16px">Live Preview</div>
        <div style="margin-top:6px;color:#bcd;font-size:13px">Preview shows immediate changes for theme, watermark, particles, audio & visual toggles.</div>
      </div>
      <div class="box">
        <div><strong>Audio:</strong> <span id="pvAudio">off</span></div>
        <div><strong>Particles:</strong> <span id="pvParticles">off</span></div>
        <div><strong>Watermark:</strong> <span id="pvWatermark">hidden</span></div>
        <div><strong>Smoke:</strong> <span id="pvSmoke">off</span></div>
      </div>
    </div>

    <!-- container for cards (will be auto-generated) -->
    <div id="cardsGrid" class="grid" style="margin-top:14px"></div>

    <footer>
      Use <code>applySettingsFromStorage()</code> on other pages to apply settings automatically. ¬© 2025 GBG
    </footer>
  </div>

  <!-- elements for visuals -->
  <!-- water / moon / particles / watermark will be created dynamically -->
  <div id="visualLayer"></div>

  <script>
  /*************************************************************************
   * GBG Ultimate Settings ‚Äî 100 Options (10 categories x 10 options)
   * - All settings saved under localStorage key 'gbg_<key>'
   * - Visuals: particles (stars), moon, water ripple, smoke
   * - Chant on click uses SpeechSynthesis "Jai Shri Ram" when enabled
   * - applySettingsFromStorage() exported for other pages
   **************************************************************************/

  // -------------------------
  // 1) Define categories & options (10 groups √ó 10 each = 100)
  // Each option: { key, label, type } where type: 'toggle'|'range'|'action'
  // -------------------------
  const categories = [
    { id:'theme_display', title:'Theme & Display', items: [
      {key:'theme', label:'Theme (light/dark/rgb/neon)', type:'choice', choices:['light','dark','rgb','neon']},
      {key:'fontSize', label:'Base Font Size', type:'range', min:12, max:22, step:1},
      {key:'showWatermark', label:'Show Watermark', type:'toggle'},
      {key:'showParticles', label:'Show Particles', type:'toggle'},
      {key:'showMoon', label:'Show Moon', type:'toggle'},
      {key:'showWater', label:'Show Water Ripple', type:'toggle'},
      {key:'colorMode', label:'Color Mode (soft/bright)', type:'choice', choices:['soft','bright']},
      {key:'bgAnimation', label:'Background Animation', type:'toggle'},
      {key:'highContrast', label:'High Contrast Mode', type:'toggle'},
      {key:'rgbSpeed', label:'RGB Animation Speed', type:'range', min:4, max:20, step:1}
    ]},
    { id:'music_sound', title:'Music & Sound', items: [
      {key:'musicOn', label:'Music ON/OFF', type:'toggle'},
      {key:'musicTrack', label:'Music Track (demo idx)', type:'range', min:0, max:3, step:1},
      {key:'sfxOn', label:'Sound Effects ON/OFF', type:'toggle'},
      {key:'clickChant', label:'Chant on Click (Jai Shri Ram)', type:'toggle'},
      {key:'notifSound', label:'Notification Sound ON/OFF', type:'toggle'},
      {key:'bgmVolume', label:'Music Volume', type:'range', min:0, max:1, step:0.01},
      {key:'sfxVolume', label:'SFX Volume', type:'range', min:0, max:1, step:0.01},
      {key:'playOnHover', label:'Play SFX on Hover', type:'toggle'},
      {key:'musicLoop', label:'Music Loop', type:'toggle'},
      {key:'allowAutoplay', label:'Autoplay Allowed (browser may block)', type:'toggle'}
    ]},
    { id:'account_privacy', title:'Account & Privacy', items: [
      {key:'enableGoogle', label:'Enable Google Sign-In', type:'toggle'},
      {key:'autoLogin', label:'Auto Login Save', type:'toggle'},
      {key:'showEmail', label:'Show Email Public', type:'toggle'},
      {key:'showProfilePic', label:'Show Profile Pic', type:'toggle'},
      {key:'shareUsage', label:'Share Usage Data', type:'toggle'},
      {key:'adsPersonal', label:'Ads Personalization', type:'toggle'},
      {key:'twoFactor', label:'2FA Mock Enable', type:'toggle'},
      {key:'privacyMode', label:'Privacy Mode', type:'toggle'},
      {key:'deleteAccount', label:'Action: Delete Account (mock)', type:'action'},
      {key:'exportData', label:'Action: Export Account Data', type:'action'}
    ]},
    { id:'features', title:'Website Features', items: [
      {key:'enableChat', label:'Enable Chat Box', type:'toggle'},
      {key:'enableAlerts', label:'Enable Popup Alerts', type:'toggle'},
      {key:'enableDownloadMgr', label:'Enable Download Manager', type:'toggle'},
      {key:'autoPreviewSkins', label:'Auto Preview Skins', type:'toggle'},
      {key:'enableGameUI', label:'Enable Game Mode UI', type:'toggle'},
      {key:'compactMode', label:'Compact Layout Mode', type:'toggle'},
      {key:'showTips', label:'Show Help Tips', type:'toggle'},
      {key:'enableRatings', label:'Enable Ratings', type:'toggle'},
      {key:'enableComments', label:'Enable Comments', type:'toggle'},
      {key:'enableNotifications', label:'Enable Browser Notifications', type:'toggle'}
    ]},
    { id:'performance', title:'Performance & Speed', items: [
      {key:'lowPower', label:'Low Power Mode', type:'toggle'},
      {key:'reducedAnimations', label:'Reduce Animations', type:'toggle'},
      {key:'lazyLoadImages', label:'Lazy Load Images', type:'toggle'},
      {key:'cacheAssets', label:'Cache Assets', type:'toggle'},
      {key:'fastMode', label:'Fast Mode (aggressive)', type:'toggle'},
      {key:'maxFPS', label:'Max Animation FPS', type:'range', min:15, max:60, step:1},
      {key:'deferScripts', label:'Defer Non-critical Scripts', type:'toggle'},
      {key:'compressTextures', label:'Compress Visuals', type:'toggle'},
      {key:'disableShadows', label:'Disable Shadows', type:'toggle'},
      {key:'perfReport', label:'Action: Generate Perf Report', type:'action'}
    ]},
    { id:'gaming_modes', title:'Gaming Modes', items: [
      {key:'proMode', label:'Pro Gamer Mode', type:'toggle'},
      {key:'streamMode', label:'Stream Mode', type:'toggle'},
      {key:'focusMode', label:'Focus Mode (hide distractions)', type:'toggle'},
      {key:'tournamentMode', label:'Tournament Mode', type:'toggle'},
      {key:'voiceCmds', label:'Enable Voice Commands', type:'toggle'},
      {key:'overlayFPS', label:'Show FPS Overlay', type:'toggle'},
      {key:'hotkeys', label:'Enable Hotkeys', type:'toggle'},
      {key:'controllerSupport', label:'Controller Support', type:'toggle'},
      {key:'vrHint', label:'VR Hints (UI)', type:'toggle'},
      {key:'resetGameUI', label:'Action: Reset Game UI', type:'action'}
    ]},
    { id:'ui_layout', title:'UI & Layout', items: [
      {key:'sidebarCompact', label:'Compact Sidebar', type:'toggle'},
      {key:'sidebarAutoClose', label:'Sidebar Auto Close', type:'toggle'},
      {key:'navGlow', label:'Nav Glow Effect', type:'toggle'},
      {key:'cardStyle', label:'Card Style (flat/carded)', type:'choice', choices:['carded','flat']},
      {key:'roundCorners', label:'Round Corners ON/OFF', type:'toggle'},
      {key:'shadowDepth', label:'Shadow Depth', type:'range', min:0, max:30, step:1},
      {key:'borderAccent', label:'Border Accent ON', type:'toggle'},
      {key:'textGlow', label:'Text Glow ON/OFF', type:'toggle'},
      {key:'compactCards', label:'Compact Cards', type:'toggle'},
      {key:'resetUI', label:'Action: Reset UI Layout', type:'action'}
    ]},
    { id:'controls', title:'Controls & Shortcuts', items: [
      {key:'hotkeyToggle', label:'Enable Hotkey Toggle (H)', type:'toggle'},
      {key:'quickSave', label:'Quick Save (Ctrl+S)', type:'toggle'},
      {key:'quickLoad', label:'Quick Load (Ctrl+L)', type:'toggle'},
      {key:'focusShortcut', label:'Focus Shortcut (F)', type:'toggle'},
      {key:'voiceShortcut', label:'Voice Shortcut (V)', type:'toggle'},
      {key:'screenshotKey', label:'Screenshot Key (P)', type:'toggle'},
      {key:'muteAllKey', label:'Mute All Key (M)', type:'toggle'},
      {key:'toggleChatKey', label:'Toggle Chat Key (C)', type:'toggle'},
      {key:'openSettingsKey', label:'Open Settings Key (G)', type:'toggle'},
      {key:'resetKeys', label:'Action: Reset Keybinds', type:'action'}
    ]},
    { id:'data_storage', title:'Data & Storage', items: [
      {key:'syncCloud', label:'Sync to Cloud (mock)', type:'toggle'},
      {key:'backupLocal', label:'Backup Local (mock)', type:'action'},
      {key:'autoBackup', label:'Auto Backup ON/OFF', type:'toggle'},
      {key:'clearCache', label:'Action: Clear Cache', type:'action'},
      {key:'analytics', label:'Analytics ON/OFF', type:'toggle'},
      {key:'errorReporting', label:'Error Reporting ON/OFF', type:'toggle'},
      {key:'dbSaveFreq', label:'DB Save Frequency (min)', type:'range', min:1, max:60, step:1},
      {key:'purgeOld', label:'Auto Purge Old Data', type:'toggle'},
      {key:'downloadData', label:'Action: Download Data', type:'action'},
      {key:'resetData', label:'Action: Reset Stored Data', type:'action'}
    ]},
    { id:'extra_tools', title:'Extra Tools', items: [
      {key:'devTools', label:'Developer Tools Hint', type:'toggle'},
      {key:'showGrid', label:'Show Layout Grid', type:'toggle'},
      {key:'screenRecord', label:'Screen Record (mock)', type:'action'},
      {key:'emojiReactions', label:'Emoji Reactions', type:'toggle'},
      {key:'translate', label:'Auto Translate (mock)', type:'toggle'},
      {key:'voiceRead', label:'Read Page Aloud', type:'action'},
      {key:'smartSuggest', label:'Smart Suggest (AI mock)', type:'toggle'},
      {key:'debugMode', label:'Debug Mode ON/OFF', type:'toggle'},
      {key:'exportFull', label:'Export Full Settings', type:'action'},
      {key:'importFull', label:'Import Full Settings', type:'action'}
    ]}
  ];

  // -------------------------
  // 2) default settings mapping (ensure all keys exist)
  // -------------------------
  const DEFAULTS = {};
  categories.forEach(cat=>{
    cat.items.forEach(item=>{
      if(item.type==='toggle'){ DEFAULTS[item.key] = (item.key.endsWith('On') || item.key.startsWith('show') || item.key.includes('enable') || item.key.includes('On')) ? 'on' : 'off'; }
      else if(item.type==='range'){ DEFAULTS[item.key] = item.min || 0; }
      else if(item.type==='choice'){ DEFAULTS[item.key] = item.choices ? item.choices[0] : ''; }
      else if(item.type==='action'){ DEFAULTS[item.key] = ''; }
    });
  });
  // tweak some sensible defaults:
  DEFAULTS['musicOn'] = 'off';
  DEFAULTS['sfxOn'] = 'on';
  DEFAULTS['clickChant'] = 'on';
  DEFAULTS['showWatermark'] = 'show';
  DEFAULTS['showParticles'] = 'show';
  DEFAULTS['showMoon'] = 'show';
  DEFAULTS['showWater'] = 'hide';
  DEFAULTS['fontSize'] = 16;
  DEFAULTS['bgmVolume'] = 0.5;
  DEFAULTS['sfxVolume'] = 0.6;
  DEFAULTS['rgbSpeed'] = 10;
  DEFAULTS['maxFPS'] = 30;

  // helper get/set with JSON parse
  function getSetting(k){
    const v = localStorage.getItem('gbg_'+k);
    if(v === null) return DEFAULTS[k];
    try { return JSON.parse(v); } catch(e) { return v; }
  }
  function setSetting(k,v){
    const payload = (typeof v==='string' || typeof v==='number') ? v : JSON.stringify(v);
    localStorage.setItem('gbg_'+k, payload);
    window.dispatchEvent(new Event('gbg_settings_changed'));
  }

  // initialize missing defaults
  Object.keys(DEFAULTS).forEach(k => {
    if(localStorage.getItem('gbg_'+k) === null) setSetting(k, DEFAULTS[k]);
  });

  // -------------------------
  // 3) Build the UI dynamically
  // -------------------------
  const grid = document.getElementById('cardsGrid');

  categories.forEach(cat=>{
    const card = document.createElement('div'); card.className='card';
    const title = document.createElement('div'); title.className='title'; title.textContent = cat.title;
    const muted = document.createElement('div'); muted.className='muted'; muted.textContent = 'Options:';
    card.appendChild(title); card.appendChild(muted);

    cat.items.forEach(item=>{
      const row = document.createElement('div'); row.style.marginBottom='8px';
      const label = document.createElement('div'); label.style.fontWeight='700'; label.style.fontSize='13px';
      label.textContent = item.label;
      row.appendChild(label);

      const controls = document.createElement('div'); controls.className='controls';
      // create control types
      if(item.type === 'toggle'){
        const btnOn = document.createElement('button'); btnOn.className='btn'; btnOn.textContent='ON';
        const btnOff = document.createElement('button'); btnOff.className='btn'; btnOff.textContent='OFF';
        btnOn.addEventListener('click', ()=>{ setSetting(item.key,'on'); onInteraction(); updateUI(); });
        btnOff.addEventListener('click', ()=>{ setSetting(item.key,'off'); onInteraction(); updateUI(); });
        controls.appendChild(btnOn); controls.appendChild(btnOff);
      } else if(item.type === 'range'){
        const input = document.createElement('input'); input.type='range'; input.className='range';
        input.min = item.min; input.max = item.max; input.step = item.step || 1; input.value = getSetting(item.key);
        input.addEventListener('input', (e)=>{ setSetting(item.key, Number(e.target.value)); onInteraction(); updateUI(); });
        controls.appendChild(input);
      } else if(item.type === 'choice'){
        item.choices.forEach(c=>{
          const b = document.createElement('button'); b.className='btn'; b.textContent = c;
          b.addEventListener('click', ()=>{ setSetting(item.key, c); onInteraction(); updateUI(); });
          controls.appendChild(b);
        });
      } else if(item.type === 'action'){
        const act = document.createElement('button'); act.className='btn'; act.textContent = 'Run';
        act.addEventListener('click', ()=>{ runAction(item.key); onInteraction(); });
        controls.appendChild(act);
      }
      row.appendChild(controls);
      card.appendChild(row);
    });

    grid.appendChild(card);
  });

  // export/import/reset quick control
  const utilitiesCard = document.createElement('div'); utilitiesCard.className='card';
  utilitiesCard.innerHTML = `<div class="title">Quick Utilities</div>
    <div class="muted">Export / Import / Reset</div>
    <div class="controls" style="margin-top:8px">
      <button class="btn" id="exportAll">Export All</button>
      <button class="btn" id="importAll">Import JSON</button>
      <button class="btn" id="resetAll">Reset Defaults</button>
    </div>
    <div class="status" id="utilStatus"></div>`;
  grid.appendChild(utilitiesCard);

  document.getElementById('exportAll').addEventListener('click', ()=>{
    const obj = {};
    Object.keys(DEFAULTS).forEach(k => obj[k] = getSetting(k));
    const blob = new Blob([JSON.stringify(obj, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'gbg-settings.json'; a.click();
    URL.revokeObjectURL(url);
    document.getElementById('utilStatus').textContent = 'Exported';
    setTimeout(()=> document.getElementById('utilStatus').textContent = '', 2000);
  });

  document.getElementById('importAll').addEventListener('click', ()=>{
    const f = document.createElement('input'); f.type='file'; f.accept='.json';
    f.onchange = async (e) => {
      const file = e.target.files[0];
      if(!file) return;
      const txt = await file.text();
      try{
        const obj = JSON.parse(txt);
        Object.keys(obj).forEach(k => { if(k in DEFAULTS) setSetting(k, obj[k]); });
        updateUI(); applyPreview(); alert('Imported settings');
      }catch(err){ alert('Invalid file'); }
    };
    f.click();
  });

  document.getElementById('resetAll').addEventListener('click', ()=>{
    if(!confirm('Reset ALL GBG settings to default?')) return;
    Object.keys(DEFAULTS).forEach(k => localStorage.removeItem('gbg_'+k));
    Object.keys(DEFAULTS).forEach(k => setSetting(k, DEFAULTS[k]));
    updateUI(); applyPreview(); alert('Reset done');
  });

  // -------------------------
  // 4) Actions implementations (mock)
  // -------------------------
  function runAction(key){
    if(key === 'deleteAccount'){ if(confirm('Delete account (mock)?')){ setSetting('logged','no'); setSetting('userName',''); setSetting('userEmail',''); alert('Account deleted (mock)'); }}
    else if(key === 'exportData'){ alert('Exporting data (mock)'); }
    else if(key === 'perfReport'){ alert('Generating performance report (mock)'); }
    else if(key === 'resetGameUI'){ alert('Game UI reset (mock)'); }
    else if(key === 'resetUI'){ alert('UI layout reset (mock)'); }
    else if(key === 'resetKeys'){ alert('Keybinds reset (mock)'); }
    else if(key === 'backupLocal'){ alert('Backup started (mock)'); }
    else if(key === 'clearCache'){ localStorage.clear(); alert('Cache (localStorage) cleared'); location.reload(); }
    else if(key === 'downloadData'){ alert('Downloading data (mock)'); }
    else if(key === 'resetData'){ if(confirm('Reset stored GBG data?')){ Object.keys(DEFAULTS).forEach(k=>localStorage.removeItem('gbg_'+k)); alert('Data reset'); location.reload(); } }
    else if(key === 'screenRecord'){ alert('Screen record (mock) started'); }
    else if(key === 'voiceRead'){ speakText('Thank you for using GBG.'); }
    else if(key === 'exportFull'){ document.getElementById('exportAll').click(); }
    else if(key === 'importFull'){ document.getElementById('importAll').click(); }
    else { alert('Action: ' + key); }
  }

  // -------------------------
  // 5) Audio / speech utilities
  // -------------------------
  const synth = window.speechSynthesis;
  function speakText(txt){
    if(!synth) return;
    const u = new SpeechSynthesisUtterance(txt);
    u.lang = 'hi-IN'; // set Hindi-ish voice if available
    u.rate = 1;
    u.volume = Number(getSetting('sfxVolume')||0.5);
    try{ synth.cancel(); synth.speak(u); }catch(e){}
  }
  // click handler that optionally plays chant
  function onInteraction(){
    // beep quick sfx
    if(getSetting('sfxOn') === 'on') playBeep(0.04, 900, 0.06);
    // chant on click
    if(getSetting('clickChant') === 'on') speakText('‡§ú‡§Ø ‡§∂‡•ç‡§∞‡•Ä ‡§∞‡§æ‡§Æ');
  }

  // tiny beep synth
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  const audioCtx = AudioCtx ? new AudioCtx() : null;
  function playBeep(vol=0.06, freq=800, dur=0.06){
    if(!audioCtx) return;
    if(getSetting('sfxOn') !== 'on') return;
    const g = audioCtx.createGain(); g.gain.value = vol * (getSetting('sfxVolume')||0.5);
    g.connect(audioCtx.destination);
    const o = audioCtx.createOscillator(); o.frequency.value = freq; o.type = 'sine';
    o.connect(g); o.start();
    setTimeout(()=>{ o.stop(); g.disconnect(); }, dur*1000);
  }

  document.getElementById('playDemoChant').addEventListener('click', ()=>{
    if(getSetting('clickChant')!=='on'){ alert('Enable "Chant on Click" option first.'); return; }
    speakText('‡§ú‡§Ø ‡§∂‡•ç‡§∞‡•Ä ‡§∞‡§æ‡§Æ');
  });

  // -------------------------
  // 6) Particles / moon / water / smoke visuals
  // -------------------------
  let particlesRunning = false;
  function createParticle(x,y,size,color){
    const d = document.createElement('div'); d.className='particle';
    d.style.left = x + 'px'; d.style.top = y + 'px';
    d.style.width = size + 'px'; d.style.height = size + 'px';
    d.style.background = `radial-gradient(circle, ${color}, rgba(0,0,0,0))`;
    document.body.appendChild(d);
    animateParticleEl(d);
  }
  function animateParticleEl(el){
    el.style.transition = `left ${6+Math.random()*8}s linear, top ${6+Math.random()*8}s linear, transform ${6+Math.random()*8}s linear`;
    (function mv(){
      if(!document.body.contains(el)) return;
      const nx = Math.random()*window.innerWidth;
      const ny = Math.random()*window.innerHeight;
      const s = 0.5 + Math.random()*1.6;
      el.style.left = nx+'px'; el.style.top = ny+'px';
      el.style.transform = 'scale('+s+')';
      setTimeout(mv, 4000 + Math.random()*4000);
    })();
  }
  function addParticles(){
    if(particlesRunning) return; particlesRunning = true;
    removeParticles();
    const theme = getSetting('theme') || 'rgb';
    const colors = { rgb:'rgba(255,80,120,0.18)', neon:'rgba(0,255,200,0.18)', dark:'rgba(0,180,255,0.12)', light:'rgba(0,0,0,0.06)' };
    for(let i=0;i<8;i++){
      const size = 60 + Math.random()*220;
      const x = Math.random()*window.innerWidth; const y = Math.random()*window.innerHeight;
      createParticle(x,y,size, colors[theme] || colors.rgb);
    }
  }
  function removeParticles(){
    particlesRunning=false;
    document.querySelectorAll('.particle').forEach(e=>e.remove());
  }

  // moon
  function addMoon(){
    if(document.querySelector('.moon')) return;
    const m = document.createElement('div'); m.className='moon';
    m.style.background = 'radial-gradient(circle at 30% 30%, rgba(255,255,240,0.9), rgba(200,200,220,0.9) 30%, rgba(0,0,0,0) 60%)';
    document.body.appendChild(m);
    // gentle float
    let dir = 1;
    setInterval(()=>{ if(!document.body.contains(m)) return; const top = 8 + Math.sin(Date.now()/4000)*2; m.style.top = top + '%'; }, 1200);
  }
  function removeMoon(){ document.querySelectorAll('.moon').forEach(e=>e.remove()); }

  // water ripple (simple)
  function addWater(){
    if(document.querySelector('.waterRipple')) return;
    const w = document.createElement('div'); w.className='waterRipple';
    document.body.appendChild(w);
    // animate background-position
    w.animate([{transform:'translateY(10%)'},{transform:'translateY(0%)'},{transform:'translateY(10%)'}],{duration:8000,iterations:Infinity});
  }
  function removeWater(){ document.querySelectorAll('.waterRipple').forEach(e=>e.remove()); }

  // smoke
  function addSmoke(){
    if(document.querySelector('.smoke')) return;
    const s = document.createElement('div'); s.className='smoke';
    s.innerHTML = '<span></span><span></span><span></span>';
    document.body.appendChild(s);
  }
  function removeSmoke(){ document.querySelectorAll('.smoke').forEach(e=>e.remove()); }

  // -------------------------
  // 7) Apply preview on this page
  // -------------------------
  const pvAudio = document.getElementById('pvAudio'), pvParticles = document.getElementById('pvParticles'), pvWatermark = document.getElementById('pvWatermark'), pvSmoke = document.getElementById('pvSmoke');

  function applyPreview(){
    // theme
    const theme = getSetting('theme');
    if(theme === 'light'){ document.body.style.background = 'linear-gradient(180deg,#f5f7fa,#eef2f6)'; document.body.style.color='#111'; }
    else if(theme === 'dark'){ document.body.style.background = '#070707'; document.body.style.color='#fff'; }
    else if(theme === 'neon'){ document.body.style.background = 'linear-gradient(270deg,#0f0c29,#302b63)'; document.body.style.color='#fff'; }
    else { document.body.style.background = 'linear-gradient(270deg,#ff004c,#00d2ff,#7b5cff)'; document.body.style.color='#fff'; }
    // font
    const fs = Number(getSetting('fontSize')||16); document.documentElement.style.fontSize = fs + 'px';

    // watermark
    if(getSetting('showWatermark') === 'show'){
      if(!document.querySelector('.gbg_watermark')){
        const w = document.createElement('div'); w.className='gbg_watermark'; w.textContent='GBG';
        document.body.appendChild(w);
      }
    } else { document.querySelectorAll('.gbg_watermark').forEach(e=>e.remove()); }

    // particles
    if(getSetting('showParticles') === 'on' || getSetting('showParticles') === 'show') addParticles(); else removeParticles();

    // moon
    if(getSetting('showMoon') === 'on' || getSetting('showMoon') === 'show') addMoon(); else removeMoon();

    // water
    if(getSetting('showWater') === 'show') addWater(); else removeWater();

    // smoke (smoking effect)
    if(getSetting('smokeEnabled') === 'on' || getSetting('smokeEnabled') === true) addSmoke(); else removeSmoke();

    // audio preview text
    pvAudio.textContent = getSetting('musicOn') === 'on' ? 'On' : 'Off';
    pvParticles.textContent = (getSetting('showParticles')==='show' || getSetting('showParticles')==='on') ? 'On' : 'Off';
    pvWatermark.textContent = (getSetting('showWatermark')==='show') ? 'Shown' : 'Hidden';
    pvSmoke.textContent = (getSetting('smokeEnabled')==='on') ? 'On' : 'Off';
  }

  // -------------------------
  // 8) UI Sync & listeners
  // -------------------------
  function updateUI(){
    // nothing heavy - preview & status only
    applyPreview();
  }

  window.addEventListener('gbg_settings_changed', ()=>{
    updateUI();
  });
  window.addEventListener('storage', (e)=>{ if(e.key && e.key.startsWith('gbg_')) updateUI(); });

  // initial UI apply
  updateUI();

  // -------------------------
  // 9) applySettingsFromStorage() -> export for other pages
  // -------------------------
  function applySettingsFromStorage(){
    try{
      // basic theme/font
      const theme = getSetting('theme');
      if(theme==='light'){ document.body.style.background='#f5f7fa'; document.body.style.color='#111'; }
      else if(theme==='dark'){ document.body.style.background='#070707'; document.body.style.color='#fff'; }
      else if(theme==='neon'){ document.body.style.background='linear-gradient(270deg,#0f0c29,#302b63)'; document.body.style.color='#fff'; }
      else { document.body.style.background='linear-gradient(270deg,#ff004c,#00d2ff,#7b5cff)'; document.body.style.color='#fff'; }
      document.documentElement.style.fontSize = (getSetting('fontSize')||16) + 'px';

      // watermark
      if(getSetting('showWatermark')==='show'){
        if(!document.querySelector('.gbg_watermark')){
          const w = document.createElement('div'); w.className='gbg_watermark'; w.textContent='GBG';
          document.body.appendChild(w);
        }
      } else { document.querySelectorAll('.gbg_watermark').forEach(e=>e.remove()); }

      // particles/moon/water/smoke
      if(getSetting('showParticles')==='show' || getSetting('showParticles')==='on') addParticles(); else removeParticles();
      if(getSetting('showMoon')==='show' || getSetting('showMoon')==='on') addMoon(); else removeMoon();
      if(getSetting('showWater')==='show') addWater(); else removeWater();
      if(getSetting('smokeEnabled')==='on') addSmoke(); else removeSmoke();

      // audio: if musicOn and an audio element with id 'bgMusic' exists, play it
      const bg = document.getElementById('bgMusic');
      if(getSetting('musicOn')==='on' && bg){ bg.volume = Number(getSetting('bgmVolume') || 0.5); bg.loop = (getSetting('musicLoop')==='on'); bg.play().catch(()=>{}); }
      else if(bg){ try{ bg.pause(); }catch(e){} }

      // chatbox example
      if(getSetting('enableChat')==='on' || getSetting('enableChat')==='enable'){ if(!document.querySelector('.gbg-chat')){ const chat = document.createElement('div'); chat.className='gbg-chat'; Object.assign(chat.style,{position:'fixed',right:'12px',bottom:'12px',width:'260px',height:'300px',background:'rgba(0,0,0,0.6)',borderRadius:'8px',zIndex:9999,padding:'8px',color:'#fff'}); chat.innerHTML='<div style="font-weight:800">GBG Chat</div><div style="font-size:13px;opacity:0.9">Community chat (demo)</div>'; document.body.appendChild(chat);} }
      else { document.querySelectorAll('.gbg-chat').forEach(e=>e.remove()); }

      // user badge if logged
      if(getSetting('logged') === 'yes'){ if(!document.getElementById('gbg_user_badge')){ const b=document.createElement('div'); b.id='gbg_user_badge'; Object.assign(b.style,{position:'fixed',left:'12px',bottom:'12px',background:'rgba(0,0,0,0.6)',padding:'8px 10px',borderRadius:'8px',zIndex:9999}); document.body.appendChild(b);} document.getElementById('gbg_user_badge').innerHTML = `<div style="font-weight:800">${getSetting('userName')||'GBG User'}</div>` + (getSetting('showEmail')==='on' ? `<div style="font-size:12px;opacity:0.8">${getSetting('userEmail')||''}</div>` : ''); }
      else { document.getElementById('gbg_user_badge')?.remove(); }

    }catch(e){ console.warn('applySettingsFromStorage error', e); }
  }

  window.applySettingsFromStorage = applySettingsFromStorage;

  // -------------------------
  // 10) small convenience: fill missing keys & expose
  // -------------------------
  // ensure certain keys used by visuals exist with initial defaults
  if(localStorage.getItem('gbg_smokeEnabled') === null) setSetting('smokeEnabled','off');

  // expose helper to global
  window.gbg = { getSetting, setSetting, applySettingsFromStorage };

  // final: initial apply
  applySettingsFromStorage();

  </script>
</body>
</html>
